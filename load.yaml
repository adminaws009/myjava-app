- name: Update ECS service with load balancer
  run: |
    aws ecs update-service --cluster <YOUR_ECS_CLUSTER_NAME> --service <YOUR_ECS_SERVICE_NAME> --task-definition ${{ steps.register-task-def.outputs.task-definition }}



- name: Update ECS service with load balancer
  run: |
    # Get the task definition ARN from the output of the previous step
    TASK_DEFINITION_ARN=$(aws ecs describe-task-definition --task-definition "${{ steps.frontend-task-def.outputs.task-definition }}" --query 'taskDefinition.taskDefinitionArn' --output text)
    
    # Update ECS service with the new task definition ARN
    aws ecs update-service \
      --cluster ${{ env.ECS_CLUSTER }} \
      --service ${{ env.ECS_FRONTEND_SERVICE }} \
      --desired-count 2 \
      --region ${{ secrets.AWS_REGION }} \
      --task-definition $TASK_DEFINITION_ARN \
      --load-balancers '[{
        "targetGroupArn": "${{ secrets.TARGET_GROUP_ARN }}",
        "containerName": "${{ env.CONTAINER_NAME }}",
        "containerPort": ${{ env.CONTAINER_PORT }}
      }]'

    # Wait for the service to stabilize
    aws ecs wait services-stable --cluster ${{ env.ECS_CLUSTER }} --services ${{ env.ECS_FRONTEND_SERVICE }} --region ${{ secrets.AWS_REGION }}